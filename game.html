<body>

<script type="text/javascript" src="./controllers/componnent.js"></script>
<script type="text/javascript" src="./controllers/scene.js"></script>
<script type="text/javascript" src="./controllers/label.js"></script>
<script type="text/javascript" src="./controllers/obstruct.js"></script>
<script type="text/javascript" src="./controllers/charactor.js"></script>

<script type="text/javascript" src="./charactors/main_charactor.js"></script>
<script type="text/javascript" src="./scenes/main_scene.js"></script>

<script type="text/javascript" src="./system.js"></script>
    
<script type="text/javascript">

    var scene = new MainScene();
    var label = new Label();

    setup(() => {
        scene.setSize(width, height);

        label.setBackgroundColor("#ffcc66");
        label.setOpacity(0.5);
        label.setSize(240, 160);
        label.setPosition(10, 10);

        buildAll(scene);
        buildAll(label)

        setPrimaryScene(scene);
        getPrimaryScene().setup();
    });

    loop(() => {
        getPrimaryScene().do((obj) => {
            if (keyMap[keySet.shift]) {
                obj.mainCharactor.setSpeed(4.0*2.0);
                obj.mainCharactor.setOpacity(0.75);
            } else {
                obj.mainCharactor.setSpeed(4.0);
                obj.mainCharactor.setOpacity(1.0);
            }

            if (keyMap[keySet.w]) {
                obj.mainCharactor.setMoveDirect("up");
            }
                
            if (keyMap[keySet.a]) {
                obj.mainCharactor.setMoveDirect("left");
            }
                
            if (keyMap[keySet.s]) {
                obj.mainCharactor.setMoveDirect("down");
            }
                
            if (keyMap[keySet.d]) {
                obj.mainCharactor.setMoveDirect("right");
            } 
                
            if (keyMap[keySet.w] && keyMap[keySet.a]) {
                obj.mainCharactor.setMoveDirect("left_up");
            } 
                
            if (keyMap[keySet.s] && keyMap[keySet.a]) {
                obj.mainCharactor.setMoveDirect("left_down");
            } 
                
            if (keyMap[keySet.w] && keyMap[keySet.d]) {
                obj.mainCharactor.setMoveDirect("right_up");
            } 
                
            if (keyMap[keySet.s] && keyMap[keySet.d]) {
                obj.mainCharactor.setMoveDirect("right_down");
            }
        });

        label.setText(
            "<ul>"
                + "<li>fps: " + fps + ", ~" + (1000/fps).toFixed(2) + "ms</li>"
                + "<li>input rate: " + inputRate + "ms </li>"
                + "<br>"
                + "<li>window: " + width + ", " + height + "</li>"
                + "<li>mouse: " + mouseX + ", " + mouseY + "</li>" 
                + "<li>keyboard: " + keyPressList.toString() + "</li>"
            + "</ul>"
        );
    });
</script>

</body>